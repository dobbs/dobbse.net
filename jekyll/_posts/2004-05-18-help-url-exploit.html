--- 
layout: post
title: Mac OS X security exploit and countermeasure
date: 2004-05-18T23:06:55
link: http://dobbse.net/thinair/2004/05/help-url-exploit.html
---
<p>Thanks to <a href="http://osx.hyperjeff.net/">Jeff</a> for posting this info on the <a href="http://comug.com">COMUG</a> mailing list and thanks also to to <a href="http://simon.incutio.com/archive/2004/05/18/defending">Simon&#39;s other pointers regarding the Mac OS X help url exploit</a>.  <strong>Update:</strong>  It is important that you follow this procedure for each user on your Mac -- the protocol helper preferences are stored separately for each user (more details at the bottom).</p>

<p>Mac <span class="caps">OS X</span> handles various <span class="caps">UR</span>Ls specially.  By default &#39;help&#39; urls are handled by Apple&#39;s Help Viewer which has the feature of allowing you to run an arbitrary script or shell command.  See Simon&#39;s post for links to harmless examples of the exploit, links to more detailed discussion, and to his preferred fix.</p>

<p>The countermeasure is to change the application that handles &#39;help&#39; urls to something other than Help Viewer.  The fixes Jeff and Simon pointed to both require downloads, and from reading the more detailed discussion, I think Simon&#39;s is a more complete solution.  But it turns out you don&#39;t have to download anything, though I had to swallow a little pride.</p>

<p>Internet Explorer allows you to change the protocol helpers for the <span class="caps">OS.</span></p>

<p>The fix is very easy.  Here&#39;s the very granular step-by-step instructions (don&#39;t be daunted by the number of steps -- I described every button click :-).  I tested this with <span class="caps">OS X 10.3.3</span> and <span class="caps">IE 5.2.3 </span>-- the steps might differ on other versions.</p>

<ol><li>Launch Internet Explorer.</li>
<li>From the <strong>Explorer* menu select *Preferences...</strong>.</li>
<li>In the left hand window pane, under the <strong>Network* section, select *Protocol Helpers</strong>.</li>
<li>In the right hand window pane, select the <strong>help</strong> protocol.</li>
<li>Click the <strong>Change...</strong> button (a Protocol Helper Editor window will appear).</li>
<li>Click the <strong>Choose Helper...</strong> (the Open dialog box will appear).</li>
<li>Choose an application other than <strong>Help Viewer* -- I chose *TextEdit</strong>.</li>
<li>Click the <strong>Open</strong> button (which will return you to the Protocol Helper Editor window).</li>
<li>Confirm that there&#39;s a check in the <strong>Use current application if possible</strong> checkbox.</li>
<li>Click the <strong>OK</strong> button (which will return you to the Preferences window).</li>
<li>Click the <strong>OK</strong> button (which will close the Preferences window).</li>
</ol>

<p>Simon&#39;s post also mentions creating a helper for the &#39;disk&#39; protocol.  The Finder will happily mount remote disk images from a <span class="caps">URL</span> which could be used in a two-part exploit: in one link you would mount a nasty script in a known location on the victim&#39;s computer via the &#39;disk&#39; url and in the other link you would use the &#39;help&#39; url to launch that nasty script.  However, &#39;ftp&#39; urls will also be mounted by the Finder, and I&#39;m fairly sure that the .Mac iDisk uses a &#39;webdav&#39; url.  There may well be others I don&#39;t know about.  Disabling the &#39;help&#39; url vulnerability will at least prevent a link on a web page from launching a nasty script.  Breaking those other urls is more than I&#39;m willing to do on my own system.  Having said that, expect to see some social engineering emails trying to get clicking assistance from naive Mac users.</p>

<p><strong>Update:</strong> Another member of <span class="caps">COMUG, </span>Dan Oetting mentioned in another email that these preferences need to be set for each user.  So I dug a little harder to see where they might be stored.  It looks like they are here:  ~/Library/Preferences/com.apple.internetconfig.plist.  That might open the possibility of creating a script to change the settings if you have a lot of macs to fix.  It&#39;s not a trivial change because the values of the protocol helpers are stored in some encoded format.</p>

<p>Quick <span class="caps">XML</span> rant:  what is the point of using an <span class="caps">XML</span> file for preferences if you&#39;re going to store values using some other encoded format?  If Apple had gone a little further xml-ifying the Internet Config preferences file, someone would already have written the script to automate the change for networks of many computers, or Macs with many user accounts.</p>
